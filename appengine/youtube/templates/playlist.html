<html>
<head>
  <title></title>

  <script type="text/javascript"
    src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>

  <script type="text/javascript">

  var ytplayer = null;
  SetupYouTubePlayer();

  function SetupYouTubePlayer() {
    var params = { allowScriptAccess: "always" };
    var atts = { id: "myytplayer" };
    swfobject.embedSWF("http://www.youtube.com/v/dn8rxxNtP7U?enablejsapi=1&playerapiid=ytplayer",
      "ytapiplayer", "425", "356", "8", null, null, params, atts);
  }

  function onYouTubePlayerReady(playerId) {
    ytplayer = document.getElementById('myytplayer');
  }

  function ClearResultsList() {
    document.getElementById('results').innerHTML = '';
  }

  function SetVideo(url) {
    ytplayer.loadVideoByUrl(url);
  }

  function AppendToResultsList(title, url, thumbnails) {
    var row = document.createElement('div');
    row.appendChild(document.createElement('div')
      .appendChild(document.createTextNode(title)));
    row.onclick = function() {
      SetVideo(url);
    }
    document.getElementById('results').appendChild(row);
  }

  function UpdateSearchResults(results) { 
    ClearResultsList();
    SetVideo(results[0].url);
    for (x in results) {
      AppendToResultsList(results[x].title, results[x].url,
        results[x].thumbnails);
    }
  }

  function DoSearch() {
    var search_input = document.getElementById('search');
    if (!search_input)
      return;
    var query = 'q=' + encodeURIComponent(search_input.value);
    var req = new XMLHttpRequest();
    req.open('GET', '/youtube/search?' + query, true);
    req.onreadystatechange = function() {
      if (req.readyState == 4 && req.status == 200) {
        var response = JSON.parse(req.responseText);
        UpdateSearchResults(response);
      }
    }
    req.send(null);
  }
  </script>
</head>

<body>

<div id="ytapiplayer">
  You need Flash Player 8+ and JavaScript enabled to view this video.
</div>

<div>
  <input type="text" id="search" size="100"/>
  <button type="button" onClick="javascript:DoSearch()">Search</button>
</div>

<div id="results"></div>

</body>

</html>
